
OpenStack
動作確認リスト
++++++++++++++++++++++++

構築後の動作確認手順をまとめました｡


■Keystoneの確認

# keystone user-list
（keystoneコマンドの動作確認するため任意のコマンドを実行）

# keystone token-get
（現在のユーザートークンを表示）

■Glanceの確認

# glance image-list
（glanceコマンドでイメージを表示）
+--------------------------------------+------------------+-------------+------------------+----------+--------+
| ID                                   | Name             | Disk Format | Container Format | Size     | Status |
+--------------------------------------+------------------+-------------+------------------+----------+--------+
| faebe079-3277-448b-a267-7f77b7a15dab | CirrOS 0.3.2-x64 | qcow2       | bare             | 13167616 | active |
+--------------------------------------+------------------+-------------+------------------+----------+--------+

■Novaコントローラノードの確認

# nova image-list
（NovaとGlanceが通信できているか確認）
+--------------------------------------+------------------+--------+--------+
| ID                                   | Name             | Status | Server |
+--------------------------------------+------------------+--------+--------+
| faebe079-3277-448b-a267-7f77b7a15dab | CirrOS 0.3.2-x64 | ACTIVE |        |
+--------------------------------------+------------------+--------+--------+

■ネットワーク・コンピュート間の確認

# ovs-vsctl show
（GRE構成の場合、各ノードでbr-tunが認識されていることを確認）

下記例は11がコントローラ兼ネットワーク、12がコンピュートノード。

Bridge br-tun
        Port "gre-1"
            Interface "gre-1"
                type: gre
                options: {in_key=flow, local_ip="192.168.0.11", out_key=flow, remote_ip="192.168.0.12"}

■Neutronの確認

# neutron net-list
（neutronコマンドでネットワークの確認）

+--------------------------------------+----------+-----------------------------------------------------+
| id                                   | name     | subnets                                             |
+--------------------------------------+----------+-----------------------------------------------------+
| 36062fbd-e7d6-4bd1-8fe9-9c04f617a8e9 | demo-net | 58365789-a3dd-4870-92c2-01432ac62529 192.168.0.0/24 |
| c9b5d516-e9ef-4eb3-8a60-f03842f93f5f | public   | 2185dbab-8a45-4aa0-b89f-0f3d3f452bb6 172.17.14.0/24 |
+--------------------------------------+----------+-----------------------------------------------------+

# neutron subnet-list
（サブネットの確認）
+--------------------------------------+-----------------+----------------+----------------------------------------------------+
| id                                   | name            | cidr           | allocation_pools                                   |
+--------------------------------------+-----------------+----------------+----------------------------------------------------+
| 2185dbab-8a45-4aa0-b89f-0f3d3f452bb6 | public_subnet   | 172.17.14.0/24 | {"start": "172.17.14.241", "end": "172.17.14.253"} |
| 58365789-a3dd-4870-92c2-01432ac62529 | demo-net_subnet | 192.168.0.0/24 | {"start": "192.168.0.100", "end": "192.168.0.254"} |
+--------------------------------------+-----------------+----------------+----------------------------------------------------+

# neutron subnet-show public_subnet
（Public側サブネットの確認）

+------------------+----------------------------------------------------+
| Field            | Value                                              |
+------------------+----------------------------------------------------+
| allocation_pools | {"start": "172.17.14.241", "end": "172.17.14.253"} |
| cidr             | 172.17.14.0/24                                     |
| dns_nameservers  |                                                    |
| enable_dhcp      | False                                              |
| gateway_ip       | 172.17.14.1                                        |
| host_routes      |                                                    |
| id               | 2185dbab-8a45-4aa0-b89f-0f3d3f452bb6               |
| ip_version       | 4                                                  |
| name             | public_subnet                                      |
| network_id       | c9b5d516-e9ef-4eb3-8a60-f03842f93f5f               |
| tenant_id        | 096a55221bbd4a7194ccb67fda58ef6e                   |
+------------------+----------------------------------------------------+

# neutron subnet-show demo-net_subnet
（Internal側サブネットの確認）

+------------------+----------------------------------------------------+
| Field            | Value                                              |
+------------------+----------------------------------------------------+
| allocation_pools | {"start": "192.168.0.100", "end": "192.168.0.254"} |
| cidr             | 192.168.0.0/24                                     |
| dns_nameservers  | 8.8.8.8                                            |
| enable_dhcp      | True                                               |
| gateway_ip       | 192.168.0.1                                        |
| host_routes      |                                                    |
| id               | 58365789-a3dd-4870-92c2-01432ac62529               |
| ip_version       | 4                                                  |
| name             | demo-net_subnet                                    |
| network_id       | 36062fbd-e7d6-4bd1-8fe9-9c04f617a8e9               |
| tenant_id        | 096a55221bbd4a7194ccb67fda58ef6e                   |
+------------------+----------------------------------------------------+


◆Pingを実行
Pingコマンドで疎通を確認します｡

# ping 172.17.14.241
（Public IPプールの一番始めのアドレスがゲートウェイになるのでPingの実施）

PING 172.17.14.241 (172.17.14.241) 56(84) bytes of data.
64 bytes from 172.17.14.241: icmp_seq=1 ttl=64 time=1.29 ms
64 bytes from 172.17.14.241: icmp_seq=2 ttl=64 time=0.059 ms
^C
--- 172.17.14.241 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1027ms
rtt min/avg/max/mdev = 0.059/0.674/1.290/0.616 ms

# ping 192.168.0.1
（Internal IPプールの一番始めのアドレスが内部ネットワークの受け口になるのでPingの実施）

PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data.
64 bytes from 192.168.0.1: icmp_seq=1 ttl=64 time=2.31 ms
64 bytes from 192.168.0.1: icmp_seq=2 ttl=64 time=0.145 ms
^C
--- 192.168.0.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1205ms
rtt min/avg/max/mdev = 0.145/1.232/2.319/1.087 ms


◆ポートのIPアドレスへPingの試行
「neutron port-list」コマンドを実行して出てくるIPアドレスにもPingをしてみます。

# neutron port-list
+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------------+
| id                                   | name | mac_address       | fixed_ips                                                                            |
+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------------+
| 23590807-4111-4b58-b485-f273dc860bbf |      | xx:xx:xx:xx:xx:xx | {"subnet_id": "58365789-a3dd-4870-92c2-01432ac62529", "ip_address": "192.168.0.100"} |
| 583a3c79-2a59-40ad-bfb7-6d0b36538436 |      | xx:xx:xx:xx:xx:xx | {"subnet_id": "58365789-a3dd-4870-92c2-01432ac62529", "ip_address": "192.168.0.1"}   |
| 5d7af4c5-83eb-4046-a9e6-22789e67f416 |      | xx:xx:xx:xx:xx:xx | {"subnet_id": "58365789-a3dd-4870-92c2-01432ac62529", "ip_address": "192.168.0.102"} |
| 8178a1e7-873b-4f32-9c48-075b6321ef71 |      | xx:xx:xx:xx:xx:xx | {"subnet_id": "2185dbab-8a45-4aa0-b89f-0f3d3f452bb6", "ip_address": "172.17.14.241"} |
| ac6b6dea-ea0d-40ca-acc4-1857c59c1c18 |      | xx:xx:xx:xx:xx:xx | {"subnet_id": "58365789-a3dd-4870-92c2-01432ac62529", "ip_address": "192.168.0.101"} |
+--------------------------------------+------+-------------------+--------------------------------------------------------------------------------------+

ポートの詳細は「neutron port-show "id"」で確認。


■セキュリティグループ（ファイアウォール）の確認
ルール"default"はデフォルトのセキュリティグループです。
セキュリティグループの設定はユーザー毎に固有です｡

# nova secgroup-list-rules default
+-------------+-----------+---------+-----------+--------------+
| IP Protocol | From Port | To Port | IP Range  | Source Group |
+-------------+-----------+---------+-----------+--------------+
|             |           |         |           | default      |
| icmp        | -1        | -1      | 0.0.0.0/0 |              |
|             |           |         |           | default      |
| tcp         | 22        | 22      | 0.0.0.0/0 |              |
+-------------+-----------+---------+-----------+--------------+

上記例ではICMPとTCP/22ポート(SSH)が開放されている。

admin以外の一般ユーザーの設定を確認するには
ユーザー用のopenrc-demoを作って確認してみましょう｡

・openrc-demo
>--
export OS_USERNAME=USER_NAME
export OS_TENANT_NAME=USER_TENANT
export OS_PASSWORD=USER_PASS
export OS_AUTH_URL=http://CONTROLLER_IP_OR_HOSTNAME:35357/v2.0/
export PS1='[\u@\h \W(keystone_demo)]\$ '
--<

# nova secgroup-list-rules default
+-------------+-----------+---------+----------+--------------+
| IP Protocol | From Port | To Port | IP Range | Source Group |
+-------------+-----------+---------+----------+--------------+
|             |           |         |          | default      |
|             |           |         |          | default      |
+-------------+-----------+---------+----------+--------------+

未設定の場合。インスタンスにはPingやリモートアクセスはできない｡